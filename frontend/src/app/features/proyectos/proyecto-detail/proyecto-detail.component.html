<div class="container mt-4">

  <!-- üü° Cargando -->
  <div *ngIf="isLoading" class="text-center">
    <p>Cargando proyecto...</p>
  </div>

  <!-- üî¥ Error -->
  <div *ngIf="!isLoading && errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <!-- üü¢ Proyecto cargado -->
  <div *ngIf="!isLoading && proyectoData" class="project-container">

    <h1 class="mb-3 text-2xl font-bold">{{ proyectoData.titulo }}</h1>

    <p class="text-gray-700 mb-4">
      {{ proyectoData.descripcion }}
    </p>

    <p><strong>Categor√≠a:</strong> {{ proyectoData.categoria }}</p>
    <p><strong>Cupos:</strong> {{ proyectoData.cupos }}</p>

    <hr class="my-4">

    <!-- ============================= -->
    <!-- üü¢ BOTONES SEG√öN EL ROL -->
    <!-- ============================= -->

    <!-- üò¥ INVITADO -->
    <div *ngIf="!userData">
      <button class="btn btn-primary"
              (click)="router.navigate(['/login'])">
        Inicia sesi√≥n para postular
      </button>
    </div>

    <!-- üë®‚Äçüéì ESTUDIANTE NO POSTULADO -->
    <div *ngIf="userData?.role === 'estudiante' && !yaPostulado">
      <button class="btn btn-success"
              (click)="postular()">
        Postular al proyecto
      </button>
    </div>

    <!-- üü¢ ESTUDIANTE YA POSTULADO -->
    <div *ngIf="userData?.role === 'estudiante' && yaPostulado">
      <button class="btn btn-warning"
              (click)="retirarPostulacion()">
        Retirar postulaci√≥n
      </button>
      <p class="text-sm mt-2 text-green-700">
        Ya est√°s postulado a este proyecto.
      </p>
    </div>

    <!-- üë®‚Äçüè´ PROFESOR -->
    <div *ngIf="userData?.role === 'profesor'">
      <button class="btn btn-secondary" disabled>
        Los profesores no pueden postular
      </button>
    </div>

    <!-- üõ° ADMIN -->
    <div *ngIf="userData?.role === 'administrador'">
      <button class="btn btn-secondary" disabled>
        Los administradores no pueden postular
      </button>
    </div>

    <hr class="my-4">

    <!-- ============================= -->
    <!-- üë• LISTADO DE PARTICIPANTES (CON NOMBRES) -->
    <!-- ============================= -->
    <div *ngIf="participantesData.length > 0">
      <h3 class="mt-4 text-lg font-semibold">Participantes</h3>
      <ul class="list-disc ml-5 mt-2">
        <li *ngFor="let p of participantesData">
          {{ p.nombre }} {{ p.apellido }} ‚Äî <span class="text-gray-600">{{ p.carrera }}</span>
        </li>
      </ul>
    </div>

    <div *ngIf="participantesData.length === 0">
      <p class="text-sm text-gray-500">A√∫n no hay participantes.</p>
    </div>

  </div>
  <hr class="my-4">
  <h3 class="text-lg font-semibold">Chat del Proyecto</h3>
    <app-proyecto-chat
      *ngIf="proyectoId"
      [proyectoId]="proyectoId">
    </app-proyecto-chat>


  <div *ngIf="userData && (yaPostulado || userData.role === 'profesor' || userData.role === 'administrador')">
    <app-proyecto-chat
      *ngIf="proyectoId"
      [proyectoId]="proyectoId">
    </app-proyecto-chat>
  </div>

  <div *ngIf="!userData">
    <p class="text-gray-500 mt-2">Inicia sesi√≥n para ver el chat.</p>
</div>

<div *ngIf="userData && !yaPostulado && userData.role === 'estudiante'">
  <p class="text-gray-500 mt-2">Debes postular para acceder al chat del proyecto.</p>
</div>

</div>
